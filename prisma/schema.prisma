generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String       @id @unique @default(uuid())
  email              String       @unique
  username           String       @unique
  password           String
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  hashedRefreshToken String?
  profile            UserProfile?
  role               String[]     @default(["USER"])
  posts              Post[]

  @@map("users")
}

model UserProfile {
  fullName       String   @default("")
  bio            String   @default("")
  address        String   @default("")
  birthdate      DateTime @default(now())
  avatar         String   @default("")
  cover          String   @default("")
  marriageStatus String   @default("")
  interests      String[] @default([])
  phone          String   @default("")
  age            Int      @default(0)
  gender         Int      @default(0)
  user           User     @relation(fields: [userId], references: [id], onDelete: SetNull)
  userId         String   @unique

  @@map("profiles")
}

model Conversation {
  id          String    @id @unique @default(uuid())
  name        String
  description String
  avatar      String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  messages    Message[]
  members     String[]  @default([])
  creator     String
  admins      String[]  @default([])

  @@map("conversations")
}

model Message {
  id             String       @id @unique @default(uuid())
  text           String
  reactions      Int?         @default(0)
  description    String?      @default("")
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  conversations  Conversation @relation(fields: [conversationId], references: [id], onDelete: SetNull)
  conversationId String       @unique
  senderId       String       @unique

  @@map("messages")
}

model Category {
  id    String              @id @unique @default(uuid())
  name  String              @unique
  posts CategoriesOnPosts[]

  @@map("categories")
}

model CategoriesOnPosts {
  id         String   @unique @default(uuid())
  post       Post     @relation(fields: [postId], references: [id])
  postId     String
  category   Category @relation(fields: [categoryId], references: [id])
  categoryId String
  createAt   DateTime @default(now())

  @@id([postId, categoryId])
  @@map("categories_on_posts")
}

model Post {
  id          String              @id @unique @default(uuid())
  description String
  files       String[]            @default([])
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  categories  CategoriesOnPosts[]
  user        User                @relation(fields: [userId], references: [id])
  userId      String

  @@map("posts")
}
